<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Transfers | byteBANK</title>
  <style>
    :root {
      --primary: #0066ff;
      --accent: #4ea8ff;
      --bg: #f5f7fa;
      --text: #333;
      --card-bg: #fff;
      --border: #ddd;
    }
    [data-theme="dark"] {
      --bg: #121212;
      --text: #f1f1f1;
      --card-bg: #1e1e1e;
      --border: #444;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 0;
      transition: background 0.3s ease;
    }

    header {
      background: var(--card-bg);
      border-bottom: 1px solid var(--border);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      font-size: 1.4rem;
      font-weight: bold;
      color: var(--primary);
    }

    .theme-toggle {
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 5px;
      padding: 0.4rem 0.8rem;
      cursor: pointer;
    }

    .container {
      max-width: 700px;
      margin: 2rem auto;
      background: var(--card-bg);
      padding: 2rem;
      border-radius: 10px;
      border: 1px solid var(--border);
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    h2 {
      color: var(--primary);
      margin-bottom: 1rem;
      text-align: center;
    }

    label {
      display: block;
      margin-bottom: 0.3rem;
      font-weight: 600;
    }

    input, select {
      width: 100%;
      padding: 0.8rem;
      margin-bottom: 1rem;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: var(--bg);
      color: var(--text);
      font-size: 1rem;
    }

    button {
      background: var(--primary);
      color: white;
      padding: 0.9rem 1.5rem;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: bold;
      width: 100%;
      cursor: pointer;
      margin-top: 1rem;
    }

    button:hover {
      background: #0056d2;
    }

    .msg {
      text-align: center;
      margin-top: 1rem;
      font-weight: 500;
    }

    footer {
      text-align: center;
      font-size: 0.9rem;
      color: #888;
      padding: 1.2rem 0;
    }

    @media (max-width: 600px) {
      .container {
        margin: 1rem;
        padding: 1.5rem;
      }
    }
  </style>
</head>
<body>

  <header>
    <div class="logo">byteBANK</div>
    <button class="theme-toggle">ðŸŒ™</button>
  </header>

  <div class="container">
    <h2>Make a Transfer</h2>
    <form id="transfer-form">
      <label for="from">From Account</label>
      <select id="from" required></select>

      <label for="to">To Account Number</label>
      <input type="text" id="to" placeholder="Enter account number" required />

      <label for="amount">Amount (â‚¦)</label>
      <input type="number" id="amount" placeholder="e.g. 10000" required min="1"/>

      <label for="note">Note (Optional)</label>
      <input type="text" id="note" placeholder="e.g. Transfer to UBA"/>

      <button type="submit">Send Money</button>
      <p class="msg" id="msg"></p>
    </form>
  </div>

  <footer>&copy; 2025 byteBANK. All rights reserved.</footer>

  <script>
    const themeBtn = document.querySelector('.theme-toggle');
    const root = document.documentElement;

    themeBtn.addEventListener('click', () => {
      const dark = root.getAttribute('data-theme') === 'dark';
      root.setAttribute('data-theme', dark ? '' : 'dark');
      themeBtn.textContent = dark ? 'ðŸŒ™' : 'â˜€ï¸';
      localStorage.setItem('theme', dark ? 'light' : 'dark');
    });

    window.addEventListener("DOMContentLoaded", () => {
      if (localStorage.getItem("theme") === "dark") {
        root.setAttribute("data-theme", "dark");
        document.querySelector(".theme-toggle").textContent = "â˜€ï¸";
      }

      const currentUser = JSON.parse(localStorage.getItem("currentUser"));
      const users = JSON.parse(localStorage.getItem("users")) || [];
      const fromSelect = document.getElementById("from");

      if (!currentUser) return;

      const user = users.find(u => u.email === currentUser.email);
      if (user?.accounts?.length) {
        user.accounts.forEach(acc => {
          const opt = document.createElement("option");
          opt.value = acc.number;
          opt.textContent = `${acc.number} (${acc.type}) - â‚¦${acc.balance}`;
          fromSelect.appendChild(opt);
        });
      }
    });

    document.getElementById("transfer-form").addEventListener("submit", (e) => {
      e.preventDefault();
      const from = document.getElementById("from").value;
      const to = document.getElementById("to").value.trim();
      const amount = parseFloat(document.getElementById("amount").value);
      const note = document.getElementById("note").value || "Fund Transfer";
      const msg = document.getElementById("msg");

      const users = JSON.parse(localStorage.getItem("users")) || [];
      const currentUser = JSON.parse(localStorage.getItem("currentUser"));

      if (!currentUser) return msg.textContent = "Please log in first.";

      const userIndex = users.findIndex(u => u.email === currentUser.email);
      if (userIndex === -1) return msg.textContent = "User not found.";

      const fromAccount = users[userIndex].accounts.find(a => a.number === from);
      if (!fromAccount || fromAccount.balance < amount) {
        msg.style.color = "salmon";
        return msg.textContent = "Insufficient balance or invalid account.";
      }

      fromAccount.balance -= amount;

      const transaction = {
        type: "transfer",
        from,
        to,
        note,
        amount,
        date: new Date().toISOString(),
        status: "Completed"
      };

      users[userIndex].transactions = users[userIndex].transactions || [];
      users[userIndex].transactions.push(transaction);

      localStorage.setItem("users", JSON.stringify(users));
      localStorage.setItem("currentUser", JSON.stringify(users[userIndex]));

      msg.style.color = "green";
      msg.textContent = "Transfer successful!";
      e.target.reset();

      setTimeout(() => {
        window.location.href = "transactions.html";
      }, 1500);
    });
  </script>
</body>
  </html>
